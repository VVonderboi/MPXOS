<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Group 13 teamName MPX: mpx_core/modules/ioscheduler.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Group 13 teamName MPX
   &#160;<span id="projectnumber">R6</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c7d74c6d2b184af75c765a147f90e5a0.html">mpx_core</a></li><li class="navelem"><a class="el" href="dir_a6b7560d91d85e776e1ad77161c04894.html">modules</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ioscheduler.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="ioscheduler_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structDCB.html">DCB</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structIOCB.html">IOCB</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structIOCBQueue.html">IOCBQueue</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structRingBuffer.html">RingBuffer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structwait.html">wait</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a5bfaf38f7c5bf559bcf4014c9b71e58c"><td class="memItemLeft" align="right" valign="top"><a id="a5bfaf38f7c5bf559bcf4014c9b71e58c"></a>
typedef struct <a class="el" href="structDCB.html">DCB</a>&#160;</td><td class="memItemRight" valign="bottom"><b>DCB</b></td></tr>
<tr class="separator:a5bfaf38f7c5bf559bcf4014c9b71e58c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa453e0a1c8753eb927e6ad5e85338543"><td class="memItemLeft" align="right" valign="top"><a id="aa453e0a1c8753eb927e6ad5e85338543"></a>
typedef struct <a class="el" href="structIOCB.html">IOCB</a>&#160;</td><td class="memItemRight" valign="bottom"><b>IOCB</b></td></tr>
<tr class="separator:aa453e0a1c8753eb927e6ad5e85338543"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00a9378517f8717dbea6c3aafb911f1d"><td class="memItemLeft" align="right" valign="top"><a id="a00a9378517f8717dbea6c3aafb911f1d"></a>
typedef struct <a class="el" href="structIOCBQueue.html">IOCBQueue</a>&#160;</td><td class="memItemRight" valign="bottom"><b>IOCBQueue</b></td></tr>
<tr class="separator:a00a9378517f8717dbea6c3aafb911f1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0132fb254601f025c3cf73363a3c90c"><td class="memItemLeft" align="right" valign="top"><a id="ac0132fb254601f025c3cf73363a3c90c"></a>
typedef struct <a class="el" href="structRingBuffer.html">RingBuffer</a>&#160;</td><td class="memItemRight" valign="bottom"><b>RingBuffer</b></td></tr>
<tr class="separator:ac0132fb254601f025c3cf73363a3c90c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1499e3a0b1664c4ffd11587154ae21c0"><td class="memItemLeft" align="right" valign="top"><a id="a1499e3a0b1664c4ffd11587154ae21c0"></a>
typedef struct <a class="el" href="structwait.html">wait</a>&#160;</td><td class="memItemRight" valign="bottom"><b>wait</b></td></tr>
<tr class="separator:a1499e3a0b1664c4ffd11587154ae21c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a61e199cf32c13a7d7c784c5bbff2dae8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ioscheduler_8h.html#a61e199cf32c13a7d7c784c5bbff2dae8">com_open</a> (int *eflag_p, int baud_rate)</td></tr>
<tr class="separator:a61e199cf32c13a7d7c784c5bbff2dae8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa39f1d25e881ffac9559b2fe816fe943"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ioscheduler_8h.html#aa39f1d25e881ffac9559b2fe816fe943">com_close</a> (void)</td></tr>
<tr class="separator:aa39f1d25e881ffac9559b2fe816fe943"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d2d449f4aadb74a2eb2b4aadeaf4b57"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ioscheduler_8h.html#a5d2d449f4aadb74a2eb2b4aadeaf4b57">com_read</a> (char *buf_p, int *count_p)</td></tr>
<tr class="separator:a5d2d449f4aadb74a2eb2b4aadeaf4b57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af03ea2dd941f2ecc4035da028d1f41b5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ioscheduler_8h.html#af03ea2dd941f2ecc4035da028d1f41b5">com_write</a> (char *buf_p, int *count_p)</td></tr>
<tr class="separator:af03ea2dd941f2ecc4035da028d1f41b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1272fe5e0902da5a4bfb03d805ed1282"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ioscheduler_8h.html#a1272fe5e0902da5a4bfb03d805ed1282">mainHandle</a> ()</td></tr>
<tr class="separator:a1272fe5e0902da5a4bfb03d805ed1282"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a368af59f4de1df8e9fa0389bb5605863"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ioscheduler_8h.html#a368af59f4de1df8e9fa0389bb5605863">inputHandle</a> ()</td></tr>
<tr class="separator:a368af59f4de1df8e9fa0389bb5605863"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8c5b52010996c627b85051fbdd9a05a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ioscheduler_8h.html#ae8c5b52010996c627b85051fbdd9a05a">outputHandle</a> ()</td></tr>
<tr class="separator:ae8c5b52010996c627b85051fbdd9a05a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefe281522a3953e61aa44a67c168b947"><td class="memItemLeft" align="right" valign="top"><a id="aefe281522a3953e61aa44a67c168b947"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>IOScheduler</b> (char *opcode, <a class="el" href="structIOCB.html">IOCB</a> *cbIn)</td></tr>
<tr class="separator:aefe281522a3953e61aa44a67c168b947"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44089a0e878b231712ce97c82b8a1a19"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structIOCBQueue.html">IOCBQueue</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ioscheduler_8h.html#a44089a0e878b231712ce97c82b8a1a19">queueOut</a> ()</td></tr>
<tr class="separator:a44089a0e878b231712ce97c82b8a1a19"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="aa39f1d25e881ffac9559b2fe816fe943"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa39f1d25e881ffac9559b2fe816fe943">&#9670;&nbsp;</a></span>com_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int com_close </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Procedure..: com_close Description..: Will set the mask register, clear the modem, enable interrupts, and restore the interrupt vector. </p>

<p class="definition">Definition at line <a class="el" href="ioscheduler_8c_source.html#l00181">181</a> of file <a class="el" href="ioscheduler_8c_source.html">ioscheduler.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                    {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">if</span>(newDCB-&gt;portflag==1){ <span class="comment">//1. check if port open</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        newDCB-&gt;portflag=0; <span class="comment">//2. clear open</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;           <span class="comment">//3. disable in PIC mask</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordtype">int</span> mask;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        cli();</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        mask = inb(0x21);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        mask = mask &amp; ~0x80;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        outb(0x21, mask);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        sti();</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="comment">//4. disable all ACC interr, zero out Modem status and Interr Enable</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordtype">int</span> modem;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        cli();</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        modem = inb(COM1+6);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        modem=modem&amp;0x00;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        outb(COM1+6,modem);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        sti();</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="keywordtype">int</span> interenable;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        cli();</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        interenable=inb(COM1+1);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        interenable=interenable&amp;0x00;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        outb(COM1+1,interenable);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        sti();</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="comment">//5. restore original saved interrupt vector</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="comment">//COM1 interrupt vector number (0030h) and level 4</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment">//idt_set_gate(24, (u32int)oldHandler, 0x08, 0x8e);</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="keywordtype">int</span> vector;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            cli();</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            vector = inb(COM1);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            vector = vector &gt;&gt; 1;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            vector = vector &gt;&gt; 1;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            vector = vector &gt;&gt; 1;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            vector = vector &gt;&gt; 1;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            outb(COM1, vector);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            sti();</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    }</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordflow">return</span> -201;<span class="comment">//port not open</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="comment">//return -1;  0 if fine, -201 if &quot;serial port not open&quot;, -1 if break on us </span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a61e199cf32c13a7d7c784c5bbff2dae8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61e199cf32c13a7d7c784c5bbff2dae8">&#9670;&nbsp;</a></span>com_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int com_open </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>eflag_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>baud_rate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Procedure..: com_open Description..: Will take in the event flag and baud rate, calculate the baud rate divisor, and initialize the <a class="el" href="structDCB.html">DCB</a> and Ring Buffer to open the COM ports. </p>

<p class="definition">Definition at line <a class="el" href="ioscheduler_8c_source.html#l00091">91</a> of file <a class="el" href="ioscheduler_8c_source.html">ioscheduler.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                                          { <span class="comment">//map 24 here</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">//1. ensure valid params and device not open</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">if</span>(eflag_p!=NULL &amp;&amp; (baud_rate == 110 || baud_rate == 150 || baud_rate == 300 || baud_rate == 600 || baud_rate == 1200 || baud_rate == 2400 || baud_rate == 4800 || baud_rate == 9600 || baud_rate == 19200)){<span class="comment">//check eflag_p &amp; baud_rate</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">if</span>(newDCB-&gt;portflag==0){<span class="comment">//check if open</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            <span class="comment">//2. init DCB;</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            newDCB-&gt;portflag = 1;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            newDCB-&gt;eventflag = eflag_p; <span class="comment">//&quot;this is a far pointer to an integer event flag.&quot; (from Detailed document); int*</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            newDCB-&gt;statuscode = <span class="stringliteral">&quot;IDLE&quot;</span>; <span class="comment">//idle, reading, writing are possible values; char*</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <span class="comment">//also init RingBuffer</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            newRing-&gt;ring[0]=NULL;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            newRing-&gt;ringHead=newRing-&gt;ring[headI];</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            newRing-&gt;ringTail=newRing-&gt;ring[i];</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            newRing-&gt;inputindex= i;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            newRing-&gt;outputindex= i;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            newRing-&gt;counter = i;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            newWait-&gt;headIOCB=NULL;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            newWait-&gt;tailIOCB=NULL;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            newIOCBQueue-&gt;queueHead=NULL;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            newIOCBQueue-&gt;queueTail=NULL;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <span class="comment">//3. save address of current interrupt handler &amp; put in new one</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="comment">//oldHandler = idt_get_gate(24);</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            idt_set_gate(24, (u32int)<a class="code" href="ioscheduler_8h.html#a1272fe5e0902da5a4bfb03d805ed1282">mainHandle</a>, 0x08, 0x8e);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <span class="comment">//4. compute baud rate divisor</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            baud_div = 115200 / (long) baud_rate;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <span class="comment">//5. Store 0x80 in Line Control Register</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                outb(COM1+3,0x80); </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                <span class="comment">//LCR is COM1 + 3</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            <span class="comment">//6. store baud_div bytes in MSB and LSB</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                <span class="comment">//Make sure that bit 7 of the LCR is 1, this enables to do so!</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                <span class="comment">//COM1 + 1</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                outb(COM1+1,baud_div);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            <span class="comment">//7. Store 0x03 in LCR</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                <span class="comment">//LCR is COM1 + 3</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                outb(COM1+3,0x03);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <span class="comment">//8. Enable right level in PIC mask reg</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;             </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keywordtype">int</span> mask2;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            cli();</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            mask2 = inb(0x21);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            mask2 = mask2 &gt;&gt; 1;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            mask2 = mask2 &gt;&gt; 1;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            mask2 = mask2 &gt;&gt; 1;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            mask2 = mask2 &gt;&gt; 1;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            outb(0x21, mask2);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            sti();</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                <span class="comment">/*outb(0x21,);//check pg 17 of doc</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">                inb(0x21);</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">                //logic AND*/</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="comment">//9. Enable main serial port inter., put 0x08 in Modem reg</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                outb(COM1+4,0x08);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <span class="comment">//10. Enable input ready inter., put 0x01 in Inter. Enable reg; see outputhandle for bit stuff (in the (), do correct level in the shift)</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                outb(COM1+1,0x01);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="keywordflow">return</span> -103;<span class="comment">//port already open</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">if</span>(*eflag_p==NULL){ <span class="comment">//bad event flag pointer</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            <span class="keywordflow">return</span> -101;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">else</span>{ <span class="comment">//bad baud rate div</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="keywordflow">return</span> -102;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">return</span> 0;<span class="comment">//0 if fine</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;}</div>
<div class="ttc" id="aioscheduler_8h_html_a1272fe5e0902da5a4bfb03d805ed1282"><div class="ttname"><a href="ioscheduler_8h.html#a1272fe5e0902da5a4bfb03d805ed1282">mainHandle</a></div><div class="ttdeci">void mainHandle()</div><div class="ttdef"><b>Definition:</b> <a href="ioscheduler_8c_source.html#l00335">ioscheduler.c:335</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5d2d449f4aadb74a2eb2b4aadeaf4b57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d2d449f4aadb74a2eb2b4aadeaf4b57">&#9670;&nbsp;</a></span>com_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int com_read </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>count_p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Procedure..: com_read Description..: Will open the input buffer, move characters from the ring buffer to the input buffer until the ring is empty, the count input is reached, or an ENTER is pressed, and return. </p>

<p class="definition">Definition at line <a class="el" href="ioscheduler_8c_source.html#l00239">239</a> of file <a class="el" href="ioscheduler_8c_source.html">ioscheduler.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                        {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">if</span>(newDCB-&gt;portflag==1){ <span class="comment">//2. check if open</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keywordflow">if</span>(buf_p!=NULL&amp;&amp;count_p!=NULL&amp;&amp;*count_p&lt;=0){ <span class="comment">//1. check params</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            <span class="comment">//3. initialize input buffer</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            newDCB-&gt;inbuffer=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) buf_p;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            newDCB-&gt;incount=*count_p;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            newDCB-&gt;statuscode = <span class="stringliteral">&quot;READ&quot;</span>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            <span class="keywordflow">while</span>(i!=0){</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                <span class="keywordflow">if</span>(newDCB-&gt;incount==newRing-&gt;counter){<span class="comment">//count been reached</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(newDCB-&gt;inbuffer[newDCB-&gt;incount]==13){<span class="comment">//CR is found</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                newDCB-&gt;inbuffer=newDCB-&gt;inbuffer + newRing-&gt;ring[i];</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                newRing-&gt;ring[i]=<span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                i--;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                actualcount++;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="keywordflow">if</span>(newDCB-&gt;incount!=actualcount){<span class="comment">//need more characters</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                newDCB-&gt;statuscode = <span class="stringliteral">&quot;IDLE&quot;</span>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                *newDCB-&gt;eventflag = 1;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <span class="keywordflow">return</span> actualcount;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordflow">else</span>{ <span class="comment">//not valid params</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="keywordflow">if</span>(buf_p==NULL){<span class="comment">//bad buffer address</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <span class="keywordflow">return</span> -302;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(count_p==NULL||*count_p&gt;0||*count_p==NULL){<span class="comment">//bad count address or value</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <span class="keywordflow">return</span> -303;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <span class="keywordflow">else</span>{<span class="comment">//device busy</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <span class="keywordflow">return</span> -304;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keywordflow">return</span> -301; <span class="comment">//port not open</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">return</span> 0;<span class="comment">//0 if fine</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="af03ea2dd941f2ecc4035da028d1f41b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af03ea2dd941f2ecc4035da028d1f41b5">&#9670;&nbsp;</a></span>com_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int com_write </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf_p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>count_p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Procedure..: com_write Description..: Will open the output buffer, get characters from the output register, move them to the correct register, and then enable interrupts. </p>

<p class="definition">Definition at line <a class="el" href="ioscheduler_8c_source.html#l00291">291</a> of file <a class="el" href="ioscheduler_8c_source.html">ioscheduler.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                                         {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="keywordflow">if</span>(newDCB-&gt;portflag==1){</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">if</span>(buf_p!=NULL&amp;&amp;count_p!=NULL&amp;&amp;*count_p&lt;=0){<span class="comment">//check params</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            newDCB-&gt;outbuffer=(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*) buf_p;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            newDCB-&gt;outcount=*count_p;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            newDCB-&gt;statuscode=<span class="stringliteral">&quot;WRITE&quot;</span>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            *newDCB-&gt;eventflag=1;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            <span class="comment">//char charIn=newDCB-&gt;inbuffer[0]; get 1st char</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordtype">int</span> writebyte;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            cli();</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            writebyte = inb(0x21);</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            writebyte = writebyte | 0x02;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            outb(0x21, writebyte);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            sti();</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keywordflow">if</span>(buf_p==NULL){</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                <span class="keywordflow">return</span> -402;<span class="comment">//invalid buffer address</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(count_p==NULL||*count_p&gt;0||*count_p==NULL){</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                <span class="keywordflow">return</span> -403;<span class="comment">//invalid count address or value</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            }</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                <span class="keywordflow">return</span> -404;<span class="comment">//device busy</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            }</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        }</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">return</span> -401;<span class="comment">//port not open</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    }</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordflow">return</span> 0;<span class="comment">//0 if fine, -401 if &quot;serial port not open&quot;, -402 if &quot;invalid buffer address&quot;, -403 if &quot;invalid count address or count value&quot;, -404 if &quot;device busy&quot;</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a368af59f4de1df8e9fa0389bb5605863"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a368af59f4de1df8e9fa0389bb5605863">&#9670;&nbsp;</a></span>inputHandle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int inputHandle </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Procedure..: inputHandle Description..: Will read in a character from the comunication port, store the character in the ring buffer if the device is not ready for it, and then move it to the input buffer when it is and return. </p>

<p class="definition">Definition at line <a class="el" href="ioscheduler_8c_source.html#l00360">360</a> of file <a class="el" href="ioscheduler_8c_source.html">ioscheduler.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                 {</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordtype">char</span> letterIn = (char) inb(COM1); <span class="comment">//1. read char from input reg</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordflow">if</span>(strcmp(newDCB-&gt;statuscode,<span class="stringliteral">&quot;READ&quot;</span>)!=0){<span class="comment">//2. if not reading, store in ring buffer;</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        newRing-&gt;ring[i] = letterIn;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        newRing-&gt;ringHead=newRing-&gt;ring[headI];</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        newRing-&gt;ringTail=newRing-&gt;ring[i];</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">else</span>{<span class="comment">//3. else, is reading. store in input buffer of requester (COM1);      </span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            outb(letterIn, newDCB-&gt;inbuffer); </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="keywordflow">if</span>(newDCB-&gt;incount!= 0 ){<span class="comment">//4. If the count is not completed and the character is not CR, return. Do not signal completion. ; decrement a count value like in polling, once is 0</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <span class="comment">//then done once hit 0</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="keywordflow">return</span> NULL; <span class="comment">//temp value, decide</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            }</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <span class="keywordflow">else</span>{<span class="comment">//5. Otherwise, the transfer has completed. Set the status to idle. Set the event flag and return the requestor&#39;s count value. </span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                newDCB-&gt;statuscode=<span class="stringliteral">&quot;IDLE&quot;</span>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                *newDCB-&gt;eventflag=1;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                <span class="keywordflow">return</span> newDCB-&gt;incount;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;            }</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1272fe5e0902da5a4bfb03d805ed1282"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1272fe5e0902da5a4bfb03d805ed1282">&#9670;&nbsp;</a></span>mainHandle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mainHandle </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Procedure..: mainHandle Description..: Will check the incoming bits to determine if it is inputting or outputting and then redirect to the correct handler. </p>

<p class="definition">Definition at line <a class="el" href="ioscheduler_8c_source.html#l00335">335</a> of file <a class="el" href="ioscheduler_8c_source.html">ioscheduler.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                 { </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordtype">int</span> EOI=0x20;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">//1. if port is not open, clear interrupt, return</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordtype">int</span> bitIn = inb(COM1 +2); <span class="comment">//2.</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordtype">int</span> get1st = bitIn&gt;&gt;1 &amp; 1;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordtype">int</span> get2nd = bitIn&gt;&gt;2 &amp; 1;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">if</span>(get1st==1 &amp;&amp; get2nd==0){</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="comment">//output interrupt</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <a class="code" href="ioscheduler_8h.html#ae8c5b52010996c627b85051fbdd9a05a">outputHandle</a>();<span class="comment">//3.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(get1st==0 &amp;&amp; get2nd==1){</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="comment">//input interrupt</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <a class="code" href="ioscheduler_8h.html#a368af59f4de1df8e9fa0389bb5605863">inputHandle</a>();<span class="comment">//3.</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="comment">//skip</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    outb(0x20, EOI);<span class="comment">//4. send eoi to pic (clears interrupt)</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;}</div>
<div class="ttc" id="aioscheduler_8h_html_a368af59f4de1df8e9fa0389bb5605863"><div class="ttname"><a href="ioscheduler_8h.html#a368af59f4de1df8e9fa0389bb5605863">inputHandle</a></div><div class="ttdeci">int inputHandle()</div><div class="ttdef"><b>Definition:</b> <a href="ioscheduler_8c_source.html#l00360">ioscheduler.c:360</a></div></div>
<div class="ttc" id="aioscheduler_8h_html_ae8c5b52010996c627b85051fbdd9a05a"><div class="ttname"><a href="ioscheduler_8h.html#ae8c5b52010996c627b85051fbdd9a05a">outputHandle</a></div><div class="ttdeci">int outputHandle()</div><div class="ttdef"><b>Definition:</b> <a href="ioscheduler_8c_source.html#l00387">ioscheduler.c:387</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae8c5b52010996c627b85051fbdd9a05a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8c5b52010996c627b85051fbdd9a05a">&#9670;&nbsp;</a></span>outputHandle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int outputHandle </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Procedure..: outputHandle Description..: Will take in a character from the output buffer, move it to the correct register, and then return. </p>

<p class="definition">Definition at line <a class="el" href="ioscheduler_8c_source.html#l00387">387</a> of file <a class="el" href="ioscheduler_8c_source.html">ioscheduler.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                  {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; <span class="comment">/*1. If the current status is not writing, ignore the interrupt and return. </span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">    2. Otherwise, if the count has not been exhausted, get the next character from the requestor&#39;s output buffer and store it in the output register. Return without signaling completion. </span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">    3. Otherwise, all characters have been transferred. Reset the status to idle. Set the event flag and return the count value. Disable write interrupts by clearing bit 1 in the interrupt enable register.*/</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">if</span>(strcmp(newDCB-&gt;statuscode,<span class="stringliteral">&quot;WRITE&quot;</span>)){<span class="comment">//1. If not writing status, return;</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    }</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">else</span>{ <span class="comment">//2. Else if count not done, get next character from output buffer and store in out reg., return;</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">if</span>(newDCB-&gt;outcount!= 0  ){</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="comment">//char* outin=inb(outbuffer);</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="comment">//outb(newDCB-&gt;outbuffer, newRing[newRing-&gt;outputindex]);</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keywordflow">else</span>{ <span class="comment">//3. Else all transfered, set idle, event flag, return count, disable write interr.</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            newDCB-&gt;statuscode=<span class="stringliteral">&quot;IDLE&quot;</span>;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            *newDCB-&gt;eventflag= 1;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <span class="comment">//disable write interrupt by clearing bit 1 in the interrupt enable register</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <span class="keywordtype">int</span> in;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            cli();</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            in=inb(COM1+1);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            in=in &amp; ~(1&lt;&lt;1);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            outb(COM1+1, in);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            sti();</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            <span class="keywordflow">return</span> newDCB-&gt;outcount;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        }</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    }</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a44089a0e878b231712ce97c82b8a1a19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44089a0e878b231712ce97c82b8a1a19">&#9670;&nbsp;</a></span>queueOut()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structIOCBQueue.html">IOCBQueue</a>* queueOut </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Procedure..: queueOut Description..: Will return the current <a class="el" href="structIOCBQueue.html">IOCBQueue</a> to the calling method to be used there. </p>

<p class="definition">Definition at line <a class="el" href="ioscheduler_8c_source.html#l00471">471</a> of file <a class="el" href="ioscheduler_8c_source.html">ioscheduler.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                     {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">return</span> newIOCBQueue;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
